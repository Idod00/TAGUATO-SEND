<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TAGUATO-SEND</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="manifest" href="/panel/manifest.json">
  <meta name="theme-color" content="#8B1A1A">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TAGUATO-SEND">
  <link rel="apple-touch-icon" href="/panel/img/logo.png">
  <link rel="stylesheet" href="/panel/css/style.css?v=2.1">
</head>
<body>

  <!-- Login Screen -->
  <div id="login-screen">
    <div class="login-box">
      <img src="/panel/img/logo.png" alt="TAGUATO" class="login-logo">
      <h1>TAGUATO-SEND <svg class="whatsapp-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg></h1>
      <p class="subtitle">Panel de gestion WhatsApp</p>
      <form id="login-form">
        <div class="form-group">
          <label for="login-user">Usuario</label>
          <input type="text" id="login-user" class="form-control" autocomplete="username" required>
        </div>
        <div class="form-group">
          <label for="login-pass">Contrasena</label>
          <input type="password" id="login-pass" class="form-control" autocomplete="current-password" required>
        </div>
        <button type="submit" id="login-btn" class="btn btn-primary" style="width:100%;margin-top:0.5rem;">Ingresar</button>
      </form>
      <div style="text-align:center;margin-top:0.75rem;">
        <button type="button" id="forgot-password-link" class="btn-link">Olvidaste tu contrasena?</button>
      </div>
    </div>
  </div>

  <!-- Change Password Screen (forced on first login) -->
  <div id="change-password-screen" class="hidden">
    <div class="login-box">
      <img src="/panel/img/logo.png" alt="TAGUATO" class="login-logo">
      <h1>Cambiar Contrasena</h1>
      <p class="subtitle">Debes cambiar tu contrasena antes de continuar</p>
      <form id="change-password-form">
        <div class="form-group">
          <label for="cp-current">Contrasena actual</label>
          <input type="password" id="cp-current" class="form-control" autocomplete="current-password" required>
        </div>
        <div class="form-group">
          <label for="cp-new">Nueva contrasena</label>
          <input type="password" id="cp-new" class="form-control" autocomplete="new-password" required minlength="8">
        </div>
        <div class="form-group">
          <label for="cp-confirm">Confirmar nueva contrasena</label>
          <input type="password" id="cp-confirm" class="form-control" autocomplete="new-password" required minlength="8">
        </div>
        <button type="submit" id="cp-btn" class="btn btn-primary" style="width:100%;margin-top:0.5rem;">Cambiar Contrasena</button>
      </form>
    </div>
  </div>

  <!-- Recovery Screen -->
  <div id="recovery-screen" class="hidden">
    <div class="login-box">
      <img src="/panel/img/logo.png" alt="TAGUATO" class="login-logo">
      <h1>Recuperar Contrasena</h1>

      <!-- Step 1: Enter username/email -->
      <div id="recovery-step1">
        <p class="subtitle">Ingresa tu usuario o email para recibir un codigo de recuperacion</p>
        <form id="recovery-step1-form">
          <div class="form-group">
            <label for="recovery-identifier">Usuario o Email</label>
            <input type="text" id="recovery-identifier" class="form-control" autocomplete="username" required>
          </div>
          <button type="submit" id="recovery-step1-btn" class="btn btn-primary" style="width:100%;margin-top:0.5rem;">Enviar codigo</button>
        </form>
        <div style="text-align:center;margin-top:0.75rem;">
          <button type="button" class="btn-link recovery-back-login">Volver al login</button>
        </div>
      </div>

      <!-- Step 2: Enter code -->
      <div id="recovery-step2" class="hidden">
        <p class="subtitle">Ingresa el codigo de 6 digitos que recibiste</p>
        <form id="recovery-step2-form">
          <div class="form-group">
            <label for="recovery-code">Codigo de verificacion</label>
            <input type="text" id="recovery-code" class="form-control" maxlength="6" pattern="[0-9]{6}" placeholder="000000" autocomplete="one-time-code" required>
          </div>
          <button type="submit" id="recovery-step2-btn" class="btn btn-primary" style="width:100%;margin-top:0.5rem;">Verificar codigo</button>
        </form>
        <div style="text-align:center;margin-top:0.75rem;display:flex;justify-content:center;gap:1rem;">
          <button type="button" id="recovery-resend-btn" class="btn-link">Reenviar codigo</button>
          <button type="button" class="btn-link recovery-back-login">Volver al login</button>
        </div>
      </div>

      <!-- Step 3: New password -->
      <div id="recovery-step3" class="hidden">
        <p class="subtitle">Ingresa tu nueva contrasena</p>
        <form id="recovery-step3-form">
          <div class="form-group">
            <label for="recovery-new-pass">Nueva contrasena</label>
            <input type="password" id="recovery-new-pass" class="form-control" autocomplete="new-password" required minlength="8">
          </div>
          <div class="form-group">
            <label for="recovery-confirm-pass">Confirmar contrasena</label>
            <input type="password" id="recovery-confirm-pass" class="form-control" autocomplete="new-password" required minlength="8">
          </div>
          <button type="submit" id="recovery-step3-btn" class="btn btn-primary" style="width:100%;margin-top:0.5rem;">Cambiar contrasena</button>
        </form>
      </div>

    </div>
  </div>

  <!-- App (hidden until logged in) -->
  <div id="app" class="hidden">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="/panel/img/logo.png" alt="TAGUATO" class="sidebar-logo">
        <div class="user-info"><span id="user-display"></span></div>
      </div>
      <nav>
        <a href="#" class="nav-link hidden" id="nav-dashboard" data-section="dashboard">Dashboard</a>
        <a href="#" class="nav-link hidden" id="nav-user-dashboard" data-section="user-dashboard">Mi Dashboard</a>
        <a href="#" class="nav-link active" data-section="instances">Instancias</a>
        <a href="#" class="nav-link" data-section="messages">Mensajes</a>
        <a href="#" class="nav-link" data-section="templates">Plantillas</a>
        <a href="#" class="nav-link" data-section="contacts">Contactos</a>
        <a href="#" class="nav-link" data-section="history">Historial</a>
        <a href="#" class="nav-link" data-section="scheduled">Programados</a>
        <a href="#" class="nav-link" data-section="webhooks">Webhooks</a>
        <a href="#" class="nav-link" data-section="sessions">Sesiones</a>
        <a href="#" class="nav-link" data-section="docs">API Docs</a>
        <a href="#" class="nav-link hidden" id="nav-status" data-section="status">Status</a>
        <a href="#" class="nav-link hidden" id="nav-admin" data-section="admin">Admin</a>
        <a href="#" class="nav-link hidden" id="nav-audit" data-section="audit">Auditoria</a>
        <a href="#" class="nav-link hidden" id="nav-backup" data-section="backup">Backups</a>
      </nav>
      <div class="sidebar-footer">
        <button id="btn-theme-toggle" class="theme-toggle" title="Cambiar tema">Tema</button>
        <button id="btn-logout" class="btn btn-ghost btn-sm" style="margin-top:0.4rem;">Cerrar sesion</button>
      </div>
    </aside>

    <!-- Main -->
    <main class="main-content">

      <!-- Dashboard Section (admin only) -->
      <div id="section-dashboard" class="section hidden">
        <h2>Dashboard</h2>
        <div id="dashboard-cards" class="dashboard-grid"></div>
        <h3 style="font-size:1rem;margin-bottom:0.75rem;color:var(--text-light);font-weight:600;">Actividad Reciente</h3>
        <div id="dashboard-activity" class="recent-activity-list"></div>
      </div>

      <!-- User Dashboard Section (all users) -->
      <div id="section-user-dashboard" class="section hidden">
        <h2>Mi Dashboard</h2>
        <div id="user-dashboard-cards" class="dashboard-grid"></div>
        <h3 style="font-size:1rem;margin:1.5rem 0 0.75rem;color:var(--text-light);font-weight:600;">Mensajes por Dia (7 dias)</h3>
        <div id="user-dashboard-chart" class="user-chart-container"></div>
      </div>

      <!-- Instances Section -->
      <div id="section-instances" class="section">
        <h2>Instancias WhatsApp</h2>
        <form id="create-instance-form" class="inline-form">
          <input type="text" id="new-instance-name" class="form-control" placeholder="Nombre de nueva instancia" required>
          <button type="submit" class="btn btn-primary">Crear</button>
        </form>
        <div id="instances-list"></div>
      </div>

      <!-- Messages Section -->
      <div id="section-messages" class="section hidden">
        <h2>Enviar Mensaje</h2>
        <form id="send-message-form" class="msg-form">
          <div class="form-group">
            <label for="msg-instance">Instancia</label>
            <select id="msg-instance" class="form-control" required>
              <option value="">Seleccionar instancia...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="msg-number">Numero destino</label>
            <input type="text" id="msg-number" class="form-control" placeholder="595981123456" required>
          </div>
          <div class="form-group">
            <label>Tipo de mensaje</label>
            <div style="display:flex;gap:0.5rem;margin-bottom:0.5rem;">
              <button type="button" class="btn btn-sm btn-primary msg-type-btn active" data-type="text" onclick="App.setMsgType('text')">Texto</button>
              <button type="button" class="btn btn-sm btn-secondary msg-type-btn" data-type="media" onclick="App.setMsgType('media')">Media</button>
            </div>
          </div>
          <div id="msg-media-fields" class="hidden">
            <div class="form-group">
              <label for="msg-media-type">Tipo de media</label>
              <select id="msg-media-type" class="form-control">
                <option value="image">Imagen</option>
                <option value="document">Documento</option>
                <option value="audio">Audio</option>
                <option value="video">Video</option>
              </select>
            </div>
            <div class="form-group">
              <label for="msg-media-url">URL del archivo (o subir abajo)</label>
              <input type="text" id="msg-media-url" class="form-control" placeholder="https://example.com/image.jpg">
            </div>
            <div class="form-group">
              <label for="msg-media-file">O subir archivo (max 10MB)</label>
              <input type="file" id="msg-media-file" class="form-control" accept="image/*,audio/*,video/*,.pdf,.doc,.docx,.xls,.xlsx">
            </div>
            <div class="form-group">
              <label for="msg-media-filename">Nombre del archivo (para documentos)</label>
              <input type="text" id="msg-media-filename" class="form-control" placeholder="archivo.pdf">
            </div>
          </div>
          <div class="form-group">
            <label for="msg-template">Plantilla (opcional)</label>
            <select id="msg-template" class="form-control">
              <option value="">Sin plantilla</option>
            </select>
          </div>
          <div class="form-group">
            <label for="msg-text" id="msg-text-label"><span id="msg-text-label-text">Mensaje</span></label>
            <div class="textarea-toolbar">
              <button type="button" class="btn-format btn-format-bold" data-target="msg-text" data-wrap="*" title="Negrita *texto*">B</button>
              <button type="button" class="btn-format btn-format-italic" data-target="msg-text" data-wrap="_" title="Cursiva _texto_">I</button>
              <button type="button" class="btn-format btn-format-strike" data-target="msg-text" data-wrap="~" title="Tachado ~texto~">S</button>
              <button type="button" class="btn-format btn-format-mono" data-target="msg-text" data-wrap="```" title="Monoespaciado ```texto```">&lt;/&gt;</button>
              <span class="toolbar-sep"></span>
              <button type="button" class="btn-emoji-trigger" data-target="msg-text" title="Insertar emoji">&#x1F600;</button>
            </div>
            <textarea id="msg-text" class="form-control" rows="4" required></textarea>
          </div>
          <button type="submit" id="msg-send-btn" class="btn btn-primary">Enviar</button>
        </form>

        <div class="bulk-divider">o</div>

        <h2>Envio Masivo</h2>
        <form id="bulk-message-form" class="bulk-form">
          <div class="form-group">
            <label for="bulk-instance">Instancia</label>
            <select id="bulk-instance" class="form-control" required>
              <option value="">Seleccionar instancia...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="bulk-numbers">Numeros (uno por linea)</label>
            <textarea id="bulk-numbers" class="form-control" rows="5" placeholder="595981123456&#10;595982654321&#10;595983111222" required></textarea>
            <div class="bulk-hint" style="display:flex;align-items:center;justify-content:space-between;">
              <span>Maximo 500 numeros</span>
              <button type="button" id="bulk-load-contacts-btn" class="btn btn-sm btn-secondary">Cargar lista</button>
            </div>
          </div>
          <div class="form-group">
            <label for="bulk-template">Plantilla (opcional)</label>
            <select id="bulk-template" class="form-control">
              <option value="">Sin plantilla</option>
            </select>
          </div>
          <div class="form-group">
            <label for="bulk-text">Mensaje</label>
            <div class="textarea-toolbar">
              <button type="button" class="btn-format btn-format-bold" data-target="bulk-text" data-wrap="*" title="Negrita *texto*">B</button>
              <button type="button" class="btn-format btn-format-italic" data-target="bulk-text" data-wrap="_" title="Cursiva _texto_">I</button>
              <button type="button" class="btn-format btn-format-strike" data-target="bulk-text" data-wrap="~" title="Tachado ~texto~">S</button>
              <button type="button" class="btn-format btn-format-mono" data-target="bulk-text" data-wrap="```" title="Monoespaciado ```texto```">&lt;/&gt;</button>
              <span class="toolbar-sep"></span>
              <button type="button" class="btn-emoji-trigger" data-target="bulk-text" title="Insertar emoji">&#x1F600;</button>
            </div>
            <textarea id="bulk-text" class="form-control" rows="4" required></textarea>
          </div>
          <button type="submit" id="bulk-send-btn" class="btn btn-primary">Enviar Masivo</button>
        </form>

        <div id="bulk-progress-zone" class="bulk-progress hidden">
          <div class="bulk-progress-header">
            <div class="bulk-progress-bar"><div id="bulk-progress-fill" class="bulk-progress-fill" style="width:0%"></div></div>
            <button type="button" id="bulk-cancel-btn" class="btn btn-danger btn-sm">Cancelar</button>
          </div>
          <div id="bulk-progress-text" class="bulk-progress-text">0 / 0</div>
          <div id="bulk-results" class="bulk-results"></div>
          <div id="bulk-failed-details"></div>
        </div>
      </div>

      <!-- Templates Section -->
      <div id="section-templates" class="section hidden">
        <h2>Plantillas de Mensajes</h2>
        <form id="create-template-form" class="admin-create-form" style="grid-template-columns:1fr 2fr;" onsubmit="return false;">
          <div class="form-group">
            <label for="new-tpl-name">Nombre</label>
            <input type="text" id="new-tpl-name" class="form-control" placeholder="Ej: Saludo" required>
          </div>
          <div class="form-group">
            <label for="new-tpl-content">Contenido</label>
            <div class="textarea-toolbar">
              <button type="button" class="btn-format btn-format-bold" data-target="new-tpl-content" data-wrap="*" title="Negrita *texto*">B</button>
              <button type="button" class="btn-format btn-format-italic" data-target="new-tpl-content" data-wrap="_" title="Cursiva _texto_">I</button>
              <button type="button" class="btn-format btn-format-strike" data-target="new-tpl-content" data-wrap="~" title="Tachado ~texto~">S</button>
              <button type="button" class="btn-format btn-format-mono" data-target="new-tpl-content" data-wrap="```" title="Monoespaciado ```texto```">&lt;/&gt;</button>
              <span class="toolbar-sep"></span>
              <button type="button" class="btn-emoji-trigger" data-target="new-tpl-content" title="Insertar emoji">&#x1F600;</button>
            </div>
            <textarea id="new-tpl-content" class="form-control" rows="2" placeholder="Hola, te escribo para..." required></textarea>
          </div>
          <div class="form-group full-width">
            <button type="submit" class="btn btn-primary">Crear Plantilla</button>
          </div>
        </form>
        <div id="templates-list"></div>
      </div>

      <!-- Contacts Section -->
      <div id="section-contacts" class="section hidden">
        <h2>Listas de Contactos</h2>
        <form id="create-contact-list-form" class="inline-form">
          <input type="text" id="new-list-name" class="form-control" placeholder="Nombre de la lista" required>
          <button type="submit" class="btn btn-primary">Crear Lista</button>
        </form>
        <div id="contact-lists-container"></div>
      </div>

      <!-- History Section -->
      <div id="section-history" class="section hidden">
        <h2>Historial de Envios</h2>
        <div class="admin-create-form" style="grid-template-columns:repeat(4,1fr);margin-bottom:1rem;">
          <div class="form-group" style="margin-bottom:0;">
            <label for="hist-status">Estado</label>
            <select id="hist-status" class="form-control">
              <option value="">Todos</option>
              <option value="sent">Enviados</option>
              <option value="failed">Fallidos</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label for="hist-type">Tipo</label>
            <select id="hist-type" class="form-control">
              <option value="">Todos</option>
              <option value="text">Texto</option>
              <option value="image">Imagen</option>
              <option value="document">Documento</option>
              <option value="audio">Audio</option>
              <option value="video">Video</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label for="hist-from">Desde</label>
            <input type="date" id="hist-from" class="form-control">
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label for="hist-to">Hasta</label>
            <input type="date" id="hist-to" class="form-control">
          </div>
          <div class="form-group full-width" style="margin-bottom:0;display:flex;gap:0.5rem;">
            <button type="button" id="hist-filter-btn" class="btn btn-primary btn-sm">Filtrar</button>
            <button type="button" id="hist-export-btn" class="btn btn-secondary btn-sm">Exportar CSV</button>
          </div>
        </div>
        <div id="history-list"></div>
        <div id="history-pagination" style="margin-top:0.75rem;display:flex;gap:0.5rem;justify-content:center;"></div>
      </div>

      <!-- Scheduled Messages Section -->
      <div id="section-scheduled" class="section hidden">
        <h2>Mensajes Programados</h2>

        <form id="create-scheduled-form" class="msg-form">
          <div class="form-group">
            <label for="sched-instance">Instancia</label>
            <select id="sched-instance" class="form-control" required>
              <option value="">Seleccionar instancia...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sched-numbers">Destinatarios (uno por linea)</label>
            <textarea id="sched-numbers" class="form-control" rows="4" placeholder="595981123456&#10;595982654321" required></textarea>
            <div class="bulk-hint" style="display:flex;align-items:center;justify-content:space-between;">
              <span>Maximo 500 numeros</span>
              <button type="button" id="sched-load-contacts-btn" class="btn btn-sm btn-secondary">Cargar lista</button>
            </div>
          </div>
          <div class="form-group">
            <label>Tipo de mensaje</label>
            <select id="sched-msg-type" class="form-control">
              <option value="text">Texto</option>
              <option value="image">Imagen</option>
              <option value="document">Documento</option>
              <option value="audio">Audio</option>
              <option value="video">Video</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sched-template">Plantilla (opcional)</label>
            <select id="sched-template" class="form-control">
              <option value="">Sin plantilla</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sched-content">Mensaje</label>
            <div class="textarea-toolbar">
              <button type="button" class="btn-format btn-format-bold" data-target="sched-content" data-wrap="*" title="Negrita *texto*">B</button>
              <button type="button" class="btn-format btn-format-italic" data-target="sched-content" data-wrap="_" title="Cursiva _texto_">I</button>
              <button type="button" class="btn-format btn-format-strike" data-target="sched-content" data-wrap="~" title="Tachado ~texto~">S</button>
              <button type="button" class="btn-format btn-format-mono" data-target="sched-content" data-wrap="```" title="Monoespaciado ```texto```">&lt;/&gt;</button>
              <span class="toolbar-sep"></span>
              <button type="button" class="btn-emoji-trigger" data-target="sched-content" title="Insertar emoji">&#x1F600;</button>
            </div>
            <textarea id="sched-content" class="form-control" rows="4" required></textarea>
          </div>
          <div id="sched-media-fields" class="hidden">
            <div class="form-group">
              <label for="sched-media-url">URL del media</label>
              <input type="text" id="sched-media-url" class="form-control" placeholder="https://example.com/image.jpg">
            </div>
            <div class="form-group">
              <label for="sched-media-caption">Caption (opcional)</label>
              <input type="text" id="sched-media-caption" class="form-control" placeholder="Descripcion del archivo">
            </div>
          </div>
          <div class="form-group">
            <label for="sched-datetime">Fecha y hora de envio</label>
            <input type="datetime-local" id="sched-datetime" class="form-control" required>
          </div>
          <button type="submit" id="sched-create-btn" class="btn btn-primary">Programar Envio</button>
        </form>

        <div class="bulk-divider">Mensajes programados</div>

        <div class="admin-create-form" style="grid-template-columns:1fr auto;margin-bottom:1rem;">
          <div class="form-group" style="margin-bottom:0;">
            <label for="sched-filter-status">Estado</label>
            <select id="sched-filter-status" class="form-control">
              <option value="">Todos</option>
              <option value="pending">Pendiente</option>
              <option value="processing">Enviando</option>
              <option value="completed">Completado</option>
              <option value="failed">Fallido</option>
              <option value="cancelled">Cancelado</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label>&nbsp;</label>
            <button type="button" id="sched-filter-btn" class="btn btn-primary btn-sm" style="width:100%;">Filtrar</button>
          </div>
        </div>

        <div id="scheduled-list"></div>
        <div id="scheduled-pagination" style="margin-top:0.75rem;display:flex;gap:0.5rem;justify-content:center;"></div>
      </div>

      <!-- Webhooks Section -->
      <div id="section-webhooks" class="section hidden">
        <h2>Webhooks</h2>
        <form id="create-webhook-form" class="admin-create-form" style="grid-template-columns:1fr 1fr 1fr;">
          <div class="form-group">
            <label for="wh-instance">Instancia</label>
            <select id="wh-instance" class="form-control" required>
              <option value="">Seleccionar instancia...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="wh-url">URL del Webhook</label>
            <input type="url" id="wh-url" class="form-control" placeholder="https://tu-server.com/webhook" required>
          </div>
          <div class="form-group">
            <label>Eventos</label>
            <div class="services-checkboxes" id="wh-events-checkboxes">
              <label><input type="checkbox" name="wh-event" value="MESSAGES_UPSERT"> Mensajes</label>
              <label><input type="checkbox" name="wh-event" value="CONNECTION_UPDATE"> Conexion</label>
              <label><input type="checkbox" name="wh-event" value="QRCODE_UPDATED"> QR Code</label>
              <label><input type="checkbox" name="wh-event" value="MESSAGES_UPDATE"> Msg Update</label>
            </div>
          </div>
          <div class="form-group full-width">
            <button type="submit" class="btn btn-primary">Crear Webhook</button>
          </div>
        </form>
        <div id="webhooks-list"></div>
      </div>

      <!-- Sessions Section -->
      <div id="section-sessions" class="section hidden">
        <h2>Sesiones Activas</h2>
        <div id="sessions-list"></div>
      </div>

      <!-- API Docs Section -->
      <div id="section-docs" class="section hidden">
        <div class="docs-header">
          <h2>API Documentation</h2>
          <p class="docs-subtitle">TAGUATO-SEND REST API &mdash; Autenticacion via header <code>apikey</code></p>
          <div class="docs-base-url">
            <span class="docs-label">Base URL:</span>
            <code id="docs-base-url"></code>
          </div>
        </div>
        <div id="docs-content"></div>
      </div>

      <!-- Admin Section -->
      <div id="section-admin" class="section hidden">
        <h2>Gestion de Usuarios</h2>

        <form id="create-user-form" class="admin-create-form">
          <div class="form-group">
            <label for="new-user-name">Usuario</label>
            <input type="text" id="new-user-name" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="new-user-pass">Contrasena</label>
            <input type="password" id="new-user-pass" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="new-user-role">Rol</label>
            <select id="new-user-role" class="form-control">
              <option value="user">user</option>
              <option value="admin">admin</option>
            </select>
          </div>
          <div class="form-group">
            <label for="new-user-max">Max instancias</label>
            <input type="number" id="new-user-max" class="form-control" value="1" min="0">
          </div>
          <div class="form-group">
            <label for="new-user-rate">Rate limit (req/s)</label>
            <input type="number" id="new-user-rate" class="form-control" placeholder="Sin limite" min="0">
          </div>
          <div class="form-group">
            <label for="new-user-email">Email</label>
            <input type="email" id="new-user-email" class="form-control" placeholder="usuario@ejemplo.com">
          </div>
          <div class="form-group">
            <label for="new-user-phone">Telefono</label>
            <input type="text" id="new-user-phone" class="form-control" placeholder="595981123456">
          </div>
          <div class="form-group full-width">
            <button type="submit" class="btn btn-primary">Crear Usuario</button>
          </div>
        </form>

        <div id="users-list"></div>
      </div>

      <!-- Audit Section (admin only) -->
      <div id="section-audit" class="section hidden">
        <h2>Auditoria</h2>
        <div class="admin-create-form" style="grid-template-columns:repeat(3,1fr);margin-bottom:1rem;">
          <div class="form-group" style="margin-bottom:0;">
            <label for="audit-action">Accion</label>
            <select id="audit-action" class="form-control">
              <option value="">Todas</option>
              <option value="user_created">user_created</option>
              <option value="user_updated">user_updated</option>
              <option value="user_deleted">user_deleted</option>
              <option value="user_login">user_login</option>
              <option value="incident_created">incident_created</option>
              <option value="incident_deleted">incident_deleted</option>
              <option value="maintenance_created">maintenance_created</option>
              <option value="maintenance_deleted">maintenance_deleted</option>
              <option value="backup_created">backup_created</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label for="audit-username">Usuario</label>
            <input type="text" id="audit-username" class="form-control" placeholder="Todos">
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label>&nbsp;</label>
            <button type="button" id="audit-filter-btn" class="btn btn-primary btn-sm" style="width:100%;">Filtrar</button>
          </div>
        </div>
        <div id="audit-list"></div>
        <div id="audit-pagination" style="margin-top:0.75rem;display:flex;gap:0.5rem;justify-content:center;"></div>
      </div>

      <!-- Backup Section (admin only) -->
      <div id="section-backup" class="section hidden">
        <h2>Backups de Base de Datos</h2>
        <div style="margin-bottom:1rem;">
          <button id="backup-create-btn" class="btn btn-primary">Crear Backup Ahora</button>
        </div>
        <div id="backup-list"></div>
      </div>

      <!-- Status Section (admin only) -->
      <div id="section-status" class="section hidden">
        <h2>Estado del Sistema</h2>

        <!-- Health overview -->
        <div id="status-health-overview" class="status-health-overview"></div>

        <!-- Create incident form -->
        <h3 style="font-size:1rem;margin-bottom:0.5rem;color:var(--primary);">Crear Incidente</h3>
        <form id="create-incident-form" class="incident-create-form">
          <div class="form-row">
            <div class="form-group" style="margin-bottom:0;">
              <label for="inc-title">Titulo</label>
              <input type="text" id="inc-title" class="form-control" placeholder="Descripcion breve del incidente" required>
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label for="inc-severity">Severidad</label>
              <select id="inc-severity" class="form-control" required>
                <option value="minor">Minor</option>
                <option value="major">Major</option>
                <option value="critical">Critical</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label for="inc-status">Estado inicial</label>
              <select id="inc-status" class="form-control">
                <option value="investigating">Investigating</option>
                <option value="identified">Identified</option>
              </select>
            </div>
          </div>
          <div class="form-row-full">
            <div class="form-group" style="margin-bottom:0;">
              <label for="inc-message">Mensaje inicial</label>
              <textarea id="inc-message" class="form-control" rows="2" placeholder="Estamos investigando problemas con..." required></textarea>
            </div>
          </div>
          <div class="form-row-full">
            <div class="form-group" style="margin-bottom:0;">
              <label>Servicios afectados</label>
              <div id="inc-services-checkboxes" class="services-checkboxes"></div>
            </div>
          </div>
          <div class="form-row-full" style="margin-top:0.75rem;">
            <button type="submit" class="btn btn-primary">Crear Incidente</button>
          </div>
        </form>

        <!-- Active incidents -->
        <h3 class="incident-section-title">Incidentes Activos</h3>
        <div id="active-incidents-list"></div>

        <!-- Past incidents -->
        <h3 class="incident-section-title">Incidentes Resueltos</h3>
        <div id="past-incidents-list"></div>

        <!-- Scheduled Maintenance -->
        <h3 style="font-size:1rem;margin:2rem 0 0.5rem;color:var(--primary);">Mantenimiento Programado</h3>
        <form id="create-maintenance-form" class="maintenance-create-form">
          <div class="form-row">
            <div class="form-group" style="margin-bottom:0;">
              <label for="maint-title">Titulo</label>
              <input type="text" id="maint-title" class="form-control" placeholder="Mantenimiento de base de datos" required>
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label for="maint-desc">Descripcion</label>
              <input type="text" id="maint-desc" class="form-control" placeholder="Descripcion opcional">
            </div>
          </div>
          <div class="form-row" style="margin-top:0.75rem;">
            <div class="form-group" style="margin-bottom:0;">
              <label for="maint-start">Inicio programado</label>
              <input type="datetime-local" id="maint-start" class="form-control" required>
            </div>
            <div class="form-group" style="margin-bottom:0;">
              <label for="maint-end">Fin programado</label>
              <input type="datetime-local" id="maint-end" class="form-control" required>
            </div>
          </div>
          <div class="form-row-full">
            <div class="form-group" style="margin-bottom:0;">
              <label>Servicios afectados</label>
              <div id="maint-services-checkboxes" class="services-checkboxes"></div>
            </div>
          </div>
          <div class="form-row-full" style="margin-top:0.75rem;">
            <button type="submit" class="btn btn-primary">Crear Mantenimiento</button>
          </div>
        </form>

        <h3 class="incident-section-title">Mantenimientos</h3>
        <div id="maintenance-list"></div>
      </div>

    </main>
  </div>

  <!-- QR Modal -->
  <div id="qr-modal" class="modal hidden">
    <div class="modal-box">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3>Conectar Instancia</h3>
      <div id="qr-content"></div>
    </div>
  </div>

  <!-- Instance Detail Modal -->
  <div id="instance-detail-modal" class="modal hidden">
    <div class="modal-box" style="max-width:650px;">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3 id="instance-detail-title">Detalle de Instancia</h3>
      <div id="instance-detail-content"></div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div id="edit-user-modal" class="modal hidden">
    <div class="modal-box">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3 id="edit-user-title">Editar Usuario</h3>
      <form id="edit-user-form">
        <input type="hidden" id="edit-user-id">
        <div class="form-group">
          <label for="edit-user-role">Rol</label>
          <select id="edit-user-role" class="form-control">
            <option value="user">user</option>
            <option value="admin">admin</option>
          </select>
        </div>
        <div class="form-group">
          <label for="edit-user-max">Max instancias</label>
          <input type="number" id="edit-user-max" class="form-control" min="0">
        </div>
        <div class="form-group">
          <label for="edit-user-rate">Rate limit (req/s, vacio = sin limite)</label>
          <input type="number" id="edit-user-rate" class="form-control" min="0" placeholder="Sin limite">
        </div>
        <div class="form-group checkbox-group">
          <input type="checkbox" id="edit-user-active">
          <label for="edit-user-active">Activo</label>
        </div>
        <div class="form-group">
          <label for="edit-user-email">Email</label>
          <input type="email" id="edit-user-email" class="form-control" placeholder="usuario@ejemplo.com">
        </div>
        <div class="form-group">
          <label for="edit-user-phone">Telefono</label>
          <input type="text" id="edit-user-phone" class="form-control" placeholder="595981123456">
        </div>
        <div class="form-group">
          <label for="edit-user-pass">Nueva contrasena (dejar vacio para no cambiar)</label>
          <input type="password" id="edit-user-pass" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </form>
    </div>
  </div>

  <!-- Incident Update Modal -->
  <div id="incident-update-modal" class="modal hidden">
    <div class="modal-box">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3>Agregar Update</h3>
      <form id="incident-update-form">
        <input type="hidden" id="iu-incident-id">
        <div class="form-group">
          <label for="iu-status">Nuevo Estado</label>
          <select id="iu-status" class="form-control" required>
            <option value="investigating">Investigating</option>
            <option value="identified">Identified</option>
            <option value="monitoring">Monitoring</option>
            <option value="resolved">Resolved</option>
          </select>
        </div>
        <div class="form-group">
          <label for="iu-message">Mensaje</label>
          <textarea id="iu-message" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Agregar Update</button>
      </form>
    </div>
  </div>

  <!-- Audit Detail Modal -->
  <div id="audit-detail-modal" class="modal hidden">
    <div class="modal-box">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3>Detalle de Auditoria</h3>
      <div id="audit-detail-content"></div>
    </div>
  </div>

  <!-- Edit Template Modal -->
  <div id="edit-template-modal" class="modal hidden">
    <div class="modal-box">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3>Editar Plantilla</h3>
      <form id="edit-template-form">
        <input type="hidden" id="edit-tpl-id">
        <div class="form-group">
          <label for="edit-tpl-name">Nombre</label>
          <input type="text" id="edit-tpl-name" class="form-control" required>
        </div>
        <div class="form-group">
          <label for="edit-tpl-content">Contenido</label>
          <div class="textarea-toolbar">
            <button type="button" class="btn-format btn-format-bold" data-target="edit-tpl-content" data-wrap="*" title="Negrita *texto*">B</button>
            <button type="button" class="btn-format btn-format-italic" data-target="edit-tpl-content" data-wrap="_" title="Cursiva _texto_">I</button>
            <button type="button" class="btn-format btn-format-strike" data-target="edit-tpl-content" data-wrap="~" title="Tachado ~texto~">S</button>
            <button type="button" class="btn-format btn-format-mono" data-target="edit-tpl-content" data-wrap="```" title="Monoespaciado ```texto```">&lt;/&gt;</button>
            <span class="toolbar-sep"></span>
            <button type="button" class="btn-emoji-trigger" data-target="edit-tpl-content" title="Insertar emoji">&#x1F600;</button>
          </div>
          <textarea id="edit-tpl-content" class="form-control" rows="5" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Guardar</button>
      </form>
    </div>
  </div>

  <!-- Load Contacts Modal -->
  <div id="load-contacts-modal" class="modal hidden">
    <div class="modal-box">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3>Cargar Lista de Contactos</h3>
      <div id="load-contacts-list"></div>
    </div>
  </div>

  <!-- Scheduled Detail Modal -->
  <div id="scheduled-detail-modal" class="modal hidden">
    <div class="modal-box" style="max-width:600px;">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3>Detalle de Envio Programado</h3>
      <div id="scheduled-detail-content"></div>
    </div>
  </div>

  <!-- Load Contacts for Scheduled Modal -->
  <div id="sched-load-contacts-modal" class="modal hidden">
    <div class="modal-box">
      <button class="modal-close" title="Cerrar">&times;</button>
      <h3>Cargar Lista de Contactos</h3>
      <div id="sched-load-contacts-list"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <!-- Emoji Picker (shared) -->
  <div id="emoji-picker" class="emoji-picker hidden">
    <div id="emoji-picker-tabs" class="emoji-picker-tabs"></div>
    <div id="emoji-picker-grid" class="emoji-picker-grid"></div>
  </div>

  <script src="/panel/js/api.js?v=2.1"></script>
  <script src="/panel/js/docs-data.js?v=2.1"></script>
  <script src="/panel/js/app.js?v=2.1"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/panel/sw.js').catch(() => {});
    }
  </script>
</body>
</html>
